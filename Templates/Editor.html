{% include head.html %}

{% if (Notes::isUserVerified(Notes::$loggedInUser)): %}

<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

{% $nonce = Session::createNonce() %}

<form action="" method="post">
    <label for="title">
        <input type="text" name="title" id="title" autofocus required maxlength="255" placeholder="Entry Title" value="{{ $entry['title'] ?? '' }}">
    </label>

    <textarea name="content" id="content" cols="66" rows="30">{{ $entry['content'] ?? '' }}</textarea>
    
    <details>
        <summary>Optional</summary>
            <input type="text" name="description" id="description" placeholder="Description" value="{{ $entry['description'] ?? '' }}">
            <span>(Optional) A short description about your entry.</span>

            <input type="text" name="slug" id="slug" maxlength="255" placeholder="Entry name" value="{{ $entry['slug'] ?? '' }}">
            <span>(Optional) This is the address your entry will be available by. Will be auto-generated if empty.</span>
    
            <input type="text" name="date" id="date" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" value="{{ $date ?? '' }}" placeholder="Entry date (YYYY-MM-DD)">
            <span>(Optional) Will be set as today if not provided</span>
    
            <input type="text" name="tags" id="tags" placeholder="Tags" value="{{ $entry['tags'] ?? '' }}">
            <span>(Optional) Space separated. E.g. blog status photography.</span>
    </details>
    
    <script>
        var easyMDE = new EasyMDE({
            placeholder: 'Content',
            autoDownloadFontAwesome: false,
            {% if (Notes::isUserCapable(Notes::$loggedInUser['id'], 'imageUpload')): %}
            uploadImage: true,
            {% endif; %}
            imageMaxSize: 1024*1024,
            imageUploadEndpoint: '/up',
            toolbar: [
                {name: 'bold', action: EasyMDE.toggleBold, className: 'icon-format_bold', title: 'Bold'},
                {name: 'italic', action: EasyMDE.toggleItalic, className: 'icon-format_italic', title: 'Italic'},
                {name: 'strikethrough', action: EasyMDE.toggleStrikethrough, className: 'icon-format_strikethrough', title: 'Strikethrough'},
                '|',
                {name: 'heading', action: EasyMDE.toggleHeadingSmaller, className: 'icon-title', title: 'Heading'},
                {name: 'ordered-list', action: EasyMDE.toggleOrderedList, className: 'icon-format_list_numbered', title: 'Ordered List'},
                {name: 'unordered-list', action: EasyMDE.toggleUnorderedList, className: 'icon-format_list_bulleted', title: 'Unordered List'},
                '|',
                {name: 'code', action: EasyMDE.toggleCodeBlock, className: 'icon-code', title: 'Code Block'},
                {name: 'code', action: EasyMDE.toggleBlockquote, className: 'icon-format_quote', title: 'Quote Block'},
                {name: 'link', action: EasyMDE.drawLink, className: 'icon-add_link', title: 'Link'},
                {name: 'image', action: EasyMDE.drawImage, className: 'icon-add_photo', title: 'Image'},
                '|',
                {% if (Notes::isUserCapable(Notes::$loggedInUser['id'], 'imageUpload')): %}
                {name: 'upload-image', action: EasyMDE.drawUploadedImage, className: 'icon-upload', title: 'Upload Image'},
                '|',
                {% endif; %}
                {name: 'side-by-side', action: EasyMDE.toggleSideBySide, className: 'icon-menu_book', title: 'Toggle Side by Side'},
                {name: 'preview', action: EasyMDE.togglePreview, className: 'icon-preview', title: 'Toggle Preview', noDisable: true},
                {name: 'fullscreen', action: EasyMDE.toggleFullScreen, className: 'icon-open_in_full', title: 'Toggle Fullscreen'},
                {name: 'guide', action: 'https://www.markdownguide.org/basic-syntax/', className: 'icon-help_outline', title: 'Markdown Guide'},
            ],
        });
    </script>

    <button name="publish" value="1" type="submit">Publish</button>&nbsp;<button name="publish" value="0">Save as Draft</button>
</form>

{% else: %}

<article>
    {{ Notes::getStatic('unverified.md') }}
</article>

{% endif %}

{% include foot.html %}